## 1 MQTT 管控接口

### 1.1 消息格式定义

#### 1.1.1 Topic

Topic 命名格式：

> /control/ `{room_id}` / `{type}`

| 参数名称      | 数据类型     | 描述               |
| --------- | -------- | ---------------- |
| `room_id` | `String` | 督/伴学室 ID         |
| `type`    | `String` | 消息类型，如 `command` |

消息类型 `type` 值为：

- `command`：命令类型消息，包括消息提醒，锁屏管控等。
- `data`：信息类型消息，包括屏幕截图数据等。
- `report` ：上报类型消息，包括举手上报，超时未操作上报等。

例如，一条文字提醒命令，其目标 Topic 应为：

```
/control/TKwRhdkErHVt/command
```

#### 1.1.2 Payload

Payload 采用 JSON 格式，每条消息均为以下格式：

| 字段名           | 类型        | 描述                                                 |
| ------------- | --------- | -------------------------------------------------- |
| `messageType` | `Integer` | 消息类型。                                              |
| `senderId`    | `String`  | 消息发送者 ID，无论是哪一方。                                   |
| `receiverID`  | `Array`   | 消息接收者 ID 字符数组，可空，**为空代表不指定接收者，由接收者自行决定是否对消息作出反应**。 |
| `timestamp`   | `String`  | 消息发送时间，使用 **ISO 8601** 格式的时间戳。                     |
| `message`     | `String`  | 实际消息内容，可空。                                         |

消息类型 `messageType` 取值为：

- **命令类型消息**，对应 Topic 的 `type` 值为 `command`，枚举范围 `[0 - 99]`
  - 音视频类消息 `(0 - 19)`
    - `0`：通知对象开始语音通话（开始推流）
    - `1`：通知对象结束语音通话（停止推流）
    - `2`：通知对象开始视频通话（开始推流）
    - `3`：通知对象切换视频源（摄像头 / 屏幕）
      - `message`：视频源枚举值（`Integer`）：
        - `0`：屏幕视频源
        - `1`：摄像头视频源
    - `4`：通知对象结束视频通话（停止推流）
  - 管控类消息 `(20 - 49)`
    - `20`：通知房间内所有对象进入督 / 伴学
    - `21`：通知房间内所有对象退出督 / 伴学
    - `22`：通知对象开始远程控制
    - `23`：通知对象结束远程控制
    - `24`：通知对象进入锁屏状态
      - `message`：提醒内容（`String`）
    - `25`：通知对象退出锁屏状态
  - 通知类消息 `[50 - 69]`
    - `50`：向对象发送提醒
      - `message`：提醒内容（`String`）
    - `51` ：命令对象截屏，并发送类型为 `101` 的消息到 `data` Topic 下
- **信息类型消息**，对应 Topic 的 `type` 值为 `data`，枚举范围为  `[100 - 139]`
  - `100`： 屏幕缩略图消息（压缩）
    - `message`：图片 Base 64 信息值（`String`）
  - `101`：屏幕实况图消息 （未压缩）
    - `message`：图片 Base 64 信息值（`String`）
- **上报类型消息**，对应 Topic 的 `type` 值为 `report`，枚举范围为 `[200 - 239]`
  - `200`：设备上线上报消息。
  - `201`：设备下线上报消息。
  - `202`：设备重连上线上报消息。
  - `203`：无人监测上报消息。
  - `204`：操作超时上报消息。
  - `205`：举手操作上报消息。

例如，一条上报屏幕缩略图图像的消息，其 Payload 应为：

```
{  
    "messageType": "100",  
    "senderId": "Q9071520055011",  
    "receiverID": "",  
    "timestamp": "2024-10-12T12:10:00Z",  
    "message": "HQvSsxmkp+bCQpAAA"  
}
```

并应发送到 Topic：

```
/control/TKwRhdkErHVt/command
```

## 2 HTTP 接口需求

### 2.1 鉴权接口

为了避免硬编码 Zego App Sign 导致后期更换复杂或是泄露，采用 Token 认证的方式进行 SDK 认证。
具体可参考: [官方教程](https://doc-zh.zego.im/faq/token_upgrade)。

- Zego Token 获取接口
  - 传参内容：加密（AES/CBC/PKCS 5 PADDING 方式）后的 UserID `(String)`
  - Token 过期时间建议为 8 小时。

### 2.2 数据接口

- 学生信息
  - 学生信息获取接口
    - 传参内容：
      - 学生 ID `(String)`
  - 更改学生签名接口：
    - 传参内容：
      - 学生 ID `(String)`
      - 签名内容 `(String)`
- 请假接口
  - 请假申请接口
    - 传参内容：
      - 课程 ID `(String)`
      - 学生 ID `(String)`
      - 请假原因 `(String)`
  - 取消请假申请接口
    - 传参内容：
      - 课程 ID `(String)`
      - 学生 ID `(String)`
      - 请假原因 `(String)`
- 成绩接口
  - 成绩填报接口
    - 传参内容：
      - 学科 ID `(String)`
      - 目标分数 `(Float)`
      - 当前分数 `(Float)`
- 心愿接口
  - 约定枚举数：
    - 心愿类型
      - 彩虹币：1
      - 分数：2
      - 自定义：3
  - 添加心愿接口
    - 传参内容：
      - 心愿类型枚举数 `(Int)`
      - 心愿标准 `(String)`
      - 心愿描述 `(String)`

